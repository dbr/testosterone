#!/usr/bin/env python
# save for clean context for tested program
__globals__ = globals()
__locals__  = locals()

import PyTest, sys

# interpret the arg on the command line as a filename to check
arg = sys.argv[1:2]
if not arg:
    print "usage: $ pytest [-arh] [filename]"
    raise SystemExit
else:
    filename = arg[0]

original = file(filename).read()
interpolated = PyTest.Interpolator().interpolate(original)

heisenberg = PyTest.Observer(filename)

__globals__['__pytest__'] = heisenberg
sys.stdout = heisenberg
exec interpolated in __globals__, __locals__
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__

print heisenberg.report()

